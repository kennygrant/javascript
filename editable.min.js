var Editable=(function(){return{Activate:function(a){if(!DOM.Exists(a)){return}DOM.Each(".content-editable-toolbar",function(c){var b="#"+c.getAttribute("data-editable")+"-editable";var d="#"+c.getAttribute("data-editable")+"-textarea";c.editable=DOM.First(b);c.textarea=DOM.First(d);c.buttons=c.querySelectorAll("a");c.textarea.style.display="none";c.textarea.form.addEventListener("submit",function(f){Editable.updateContent(c.editable,c.textarea,false);return false});c.editable.addEventListener("input",function(f){Editable.cleanHTMLElements(this)});DOM.ForEach(c.buttons,function(f,e){f.addEventListener("click",function(j){var i=this.id;var h="";switch(i){case"showCode":Editable.updateContent(c.editable,c.textarea,true);break;case"createLink":h=prompt("Supply the web URL to link to");if(h.indexOf("http")!==0){h="http://"+h}break;case"formatblock":h=this.getAttribute("data-format");break;default:break}if(i.length>0){document.execCommand(i,false,h)}var g=Editable.getSelectionParentElement();if(g!==null){Editable.cleanAlign(i,g);Editable.cleanHTMLElements(g);g.removeAttribute("style")}return false})})})},cleanAlign:function(a){switch(cmd){case"justifyCenter":if(sel.hasClass("align-center")){sel.removeClass("align-center")}else{sel.addClass("align-center")}sel.removeClass("align-left").removeClass("align-right");sel.removeAttr("style");break;case"justifyLeft":if(sel.hasClass("align-left")){sel.removeClass("align-left")}else{sel.addClass("align-left")}sel.removeClass("align-center").removeClass("align-right");sel.removeAttribute("style");break;case"justifyRight":if(sel.hasClass("align-right")){sel.removeClass("align-right")}else{sel.addClass("align-right")}sel.removeClass("align-center").removeClass("align-left");sel.removeAttribute("style");break}},cleanHTML:function(a){a=a.replace(/<\/?span>/gi,"");a=a.replace(/<\/?font [^>]*>/gi,"");a=a.replace(/&nbsp;</gi," <");a=a.replace(/<p><\/p>/gi,"\n");a=a.replace(/<br><\/li>/gi,"</li>");a=a.replace(/<!--[\w\d\[\]\s<\/>:.!="*{};-]*-->/gi,"");a=a.replace(/ class\=\"MsoNormal\"/gi,"");a=a.replace(/<p><o:p> <\/o:p><\/p>/gi,"");a=a.replace(/><(li|ul|ol|p|h\d|\/ul|\/ol)>/gi,">\n<$1>");return a},cleanHTMLElements:function(a){DOM.ForEach(a.querySelectorAll("p, div, b, i, h1, h2, h3, h4, h5, h6"),function(b){b.removeAttribute("style")});DOM.ForEach(a.querySelectorAll("span"),function(b){b.removeAttribute("style");b.removeAttribute("lang")});DOM.ForEach(a.querySelectorAll("font"),function(b){b.removeAttribute("color")})},updateContent:function(d,b,a){var c="";if(b.style.display!=="none"){c=b.value;d.innerHTML=c;if(a){d.style.display="";b.style.display="none"}}else{c=d.innerHTML;c=Editable.cleanHTML(c);b.value=c;if(a){d.style.display="none";b.style.display=""}}},getSelectionParentElement:function(){var b=null,a;if(window.getSelection){a=window.getSelection();if(a.rangeCount){b=a.getRangeAt(0).commonAncestorContainer;if(b.nodeType!=1){b=b.parentNode}}}else{if((a=document.selection)&&a.type!="Control"){b=a.createRange().parentElement()}}return b}}}());