DOM.Ready(function(){Editable.Activate(".content-editable-toolbar")});var Editable=(function(){return{Activate:function(a){if(!DOM.Exists(a)){return}DOM.Each(".content-editable-toolbar",function(b){b.buttons=b.querySelectorAll("a");var c=b.getAttribute("data-editable");b.editable=DOM.First(DOM.Format("#{0}-editable",c));b.textarea=DOM.First(DOM.Format("#{0}-textarea",c));if(b.editable===undefined){b.editable=DOM.Nearest(b,".content-editable")[0]}if(b.textarea===undefined){b.textarea=DOM.Nearest(b,".content-textarea")[0]}b.textarea.style.display="none";b.textarea.form.addEventListener("submit",function(d){Editable.updateContent(b.editable,b.textarea,false);return false});b.editable.addEventListener("input",function(d){Editable.cleanHTMLElements(this)});DOM.ForEach(b.buttons,function(e,d){e.addEventListener("click",function(i){var h=this.id;var g="";switch(h){case"showCode":Editable.updateContent(b.editable,b.textarea,true);break;case"createLink":g=prompt("Supply the web URL to link to");if(g.indexOf("http")!==0){g="http://"+g}break;case"formatblock":g=this.getAttribute("data-format");break;default:break}if(h.length>0){document.execCommand(h,false,g)}var f=Editable.getSelectionParentElement();if(f!==null){Editable.cleanAlign(h,f);Editable.cleanHTMLElements(f);f.removeAttribute("style")}return false})})})},cleanAlign:function(b,a){switch(b){case"justifyCenter":if(sel.hasClass("align-center")){sel.removeClass("align-center")}else{sel.addClass("align-center")}sel.removeClass("align-left").removeClass("align-right");sel.removeAttr("style");break;case"justifyLeft":if(sel.hasClass("align-left")){sel.removeClass("align-left")}else{sel.addClass("align-left")}sel.removeClass("align-center").removeClass("align-right");sel.removeAttribute("style");break;case"justifyRight":if(sel.hasClass("align-right")){sel.removeClass("align-right")}else{sel.addClass("align-right")}sel.removeClass("align-center").removeClass("align-left");sel.removeAttribute("style");break}},cleanHTML:function(a){a=a.replace(/<\/?span>/gi,"");a=a.replace(/<\/?font [^>]*>/gi,"");a=a.replace(/&nbsp;</gi," <");a=a.replace(/<p><\/p>/gi,"\n");a=a.replace(/<br><\/li>/gi,"</li>");a=a.replace(/<!--[\w\d\[\]\s<\/>:.!="*{};-]*-->/gi,"");a=a.replace(/ class\=\"MsoNormal\"/gi,"");a=a.replace(/<p><o:p> <\/o:p><\/p>/gi,"");a=a.replace(/><(li|ul|ol|p|h\d|\/ul|\/ol)>/gi,">\n<$1>");return a},cleanHTMLElements:function(a){DOM.ForEach(a.querySelectorAll("p, div, b, i, h1, h2, h3, h4, h5, h6"),function(b){b.removeAttribute("style")});DOM.ForEach(a.querySelectorAll("span"),function(b){b.removeAttribute("style");b.removeAttribute("lang")});DOM.ForEach(a.querySelectorAll("font"),function(b){b.removeAttribute("color")})},updateContent:function(d,b,a){var c="";if(b.style.display!=="none"){c=b.value;d.innerHTML=c;if(a){d.style.display="";b.style.display="none"}}else{c=d.innerHTML;c=Editable.cleanHTML(c);b.value=c;if(a){d.style.display="none";b.style.display=""}}},getSelectionParentElement:function(){var b=null,a;if(window.getSelection){a=window.getSelection();if(a.rangeCount){b=a.getRangeAt(0).commonAncestorContainer;if(b.nodeType!=1){b=b.parentNode}}}else{if((a=document.selection)&&a.type!="Control"){b=a.createRange().parentElement()}}return b}}}());